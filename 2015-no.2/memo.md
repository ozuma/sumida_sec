# 今回のテーマ：隠す(hide)

Hide in shadow → ambushってWizardy 5にありましたね

## ITセキュリティにおける「隠す」

- 攻撃、あるいはそれに準じる行為を隠す
    - nmapでゆっくりスキャンする(-T1)。1日1ポートスキャンすればたぶん絶対に気付かれない
    - ShellShockで、UserAgentなど目立つヘッダではなく、X-Hogehoge:みたいな誰もログを取らないだろうヘッダに入れている攻撃者もいた
- セキュリティルールをかいくぐるために隠す
    - VPNによるトンネル
    - 443/tcp(https)で、httpsでは無いものを通す
    - ICMP(ping)のペイロードにメッセージを入れてしまう
- リソースを隠す
    - pingへの応答をしないようにする(ホストの存在を隠す)、対Host Discovery
    - 開放ポートを隠す(SYNスキャンに対して、全開放しているかのように振る舞うIPSがある)
    - ソフトウェアの情報を隠す
        - バナーを出さない
        - デバッグモードのOFF
        - システム関連のエラーメッセージは内部ログのみに出し、Webブラウザには表示させない、など(Perlの`use CGI::Carp qw(fatalsToBrowser);`)
    - 秘密ファイルを推測できないパスに設置する

攻撃側による「行為を隠す」のと、防御側による「リソースを隠す(ホストの存在、開放ポート、ミドルウェアのバナーなど)」が多いかな。どちらかというと、SYNスキャンをステルススキャンと呼ぶように、攻撃側の「隠す」需要が多い。

## 探査行為を隠す

- 潜水艦のソナー
    - パッシブソナー：音を聞くだけなので、探査していることを相手に察知されない。方位しか分からない(距離が分からない)、相手が止まっている時は分からない
    - アクティブソナー：戦闘機などのレーダーと同じ。探査のための音波を発射して、その反射から敵艦の位置を測定する。浴びた方も確実に気付くし、自艦の方位も取られるので諸刃の剣。
    - 詳しくは「沈黙の艦隊」を読もう!
    - ステルス性：反射波が少ない。スキャンされても気付かれないようにする

- ポートスキャンを隠す
    - TCPコネクトスキャンではなく、SYNスキャンを使う
    - ゆっくりしていってね!!!!!
        - タイミングオプションで、-T1などを使う
        - 極端な話、1日1個しかポートスキャンしなければ、たぶん相手は気付かない。ITセキュリティにおいて攻撃側が有利と言われる理由の一つに、いくらでも遅くできるという点がある
    - 基本的にセキュリティ監視では、アラートのしきい値を設定しているので、そのしきい値以下となるようにみんながシノギを削っている
    - 逆に、潜水艦のアクティブソナーに当たるようなAggressiveなスキャンも散見されるけど、それは本講ではあまり考えない

### 実演：nmap -T1

- どれくらい遅いのか示す
- 通常のオプションは何か？ → -T3

## 防御側：リソースを隠す

色々あるけど、本講ではsshのポート番号を22/tcpから変えるのどうよ問題と、それに対する議論のネタとして「科学忍法・ssh分身の術」をお見せします(やっと本題に来た)。


